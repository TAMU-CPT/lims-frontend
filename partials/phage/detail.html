<style>
.phage-card .md-title-prefix {
	color: rgba(0,0,0,0.87)
}
.phage-card .md-title {
	color: black;
	font-weight: 700;
}
</style>
<div layout="row" layout-align="center">
	<div flex=40>
		<md-card>
			<md-toolbar layout="row" class="md-hue-1">
				<div class="md-toolbar-tools phage-card" flex>
					<span class="md-title-prefix">Phage&nbsp;</span>
					<span class="md-title">{{ data.primary_name }}</span>
					<span flex></span>
					<!-- TODO: Show if user -->
					<md-button class="md-icon-button" aria-label="Edit User Information" ng-click="edit_data()" ng-if="disabled">
						<ng-md-icon icon="edit"></ng-md-icon>
					</md-button>
					<md-button class="md-icon-button" aria-label="Save Changes" ng-click="edit_data_save()" ng-if="!disabled">
						<ng-md-icon icon="save"></ng-md-icon>
					</md-button>
					<md-button class="md-icon-button" aria-label="Cancel Changes" ng-click="edit_data_cancel()" ng-if="!disabled">
						<ng-md-icon icon="cancel"></ng-md-icon>
					</md-button>
				</div>
			</md-toolbar>

			<md-card-header ng-if="disabled && data.historical_names" style="-bottom:0px">
				<md-card-header-text>
					<span flex class="md-subhead">
						Historically known as: {{ data.historical_names }}
					</span>
				</md-card-header-text>
			</md-card-header>
			<md-card-content>
				<div layout="column">
					<md-input-container flex ng-if="!disabled">
						<label>Name</label>
						<input ng-disabled="disabled" ng-model="data.primary_name">
					</md-input-container>

					<md-input-container flex ng-if="!disabled">
						<label>Historical Names</label>
						<input ng-disabled="disabled" ng-model="data.historical_names">
					</md-input-container>


					<h3>Hosts</h3>

					<md-chips
						ng-model="data.host_lims"
						readonly="disabled"
						md-transform-chip="ctrl.transformChip($chip)"
						md-require-match="false">
						<md-autocomplete
							md-selected-item="ctrl.selectedItem"
							md-search-text="ctrl.searchText"
							md-items="item in ctrl.querySearch(ctrl.searchText)"
							md-item-text="item.genus"
							placeholder="Search for a Host">
							<span md-highlight-text="ctrl.searchText">{{item.genus}} {{item.species}} {{item.strain}}</span>
						</md-autocomplete>
						<md-chip-template>
							<span>
								<a ng-href="#/bacteria/{{ $chip.id }}/">
									<i>{{$chip.genus}} {{$chip.species}}</i> {{$chip.strain}}
								</a>
							</span>
						</md-chip-template>
					</md-chips>



				</div>
			</md-card-content>
		</md-card>

		<md-card>
			<md-toolbar layout="row" class="md-hue-1">
				<div class="md-toolbar-tools media--card" flex>
					<span class="md-title">Media</span>
					<span flex></span>
					<!-- TODO: Show if user -->
					<md-button class="md-icon-button" aria-label="Upload a Picture" ng-click="upload_media()">
						<ng-md-icon icon="add"></ng-md-icon>
					</md-button>
				</div>
			</md-toolbar>
			<md-card-title-media>
				<div class="md-media-md card-media">
					<img src="http://placekitten.com/g/500/500" />
				</div>
			</md-card-title-media>
		</md-card>
	</div>
	<div flex=60 layout="column">

		<div layout="row">
			<span flex></span>
			<ng-md-icon icon="arrow_upwards"></ng-md-icon>
			<span flex></span>
		</div>

		<md-card class="lysate-card" ng-if="data.lysate">
			<md-toolbar layout="row" class="md-hue-2">
				<div class="md-toolbar-tools" flex>
					<span class="md-title">Lysate</span>
					<span flex></span>

					<md-button aria-label="Add a tube" class="md-icon-button" ng-if="!data.lysate.tube.id">
						<ng-md-icon icon="add"></ng-md-icon>
						<md-tooltip>
							We don't have a tube on record containing this phage. Add one?
						</md-tooltip>
					</md-button>
					<md-button ng-href="#/tubes/{{ data.lysate.tube.id }}" aria-label="Go to tube in inventory" class="md-icon-button" ng-if="data.lysate.tube.id">
						<ng-md-icon icon="inbox"></ng-md-icon>
						<md-tooltip>
							Tube {{ data.lysate.tube.name }}
						</md-tooltip>
					</md-button>
				</div>
			</md-toolbar>
			<md-card-content>
				<md-table-container>
					<table md-table md-progress="promise">
						<thead md-head>
							<tr md-row>
								<th md-column>Property</th>
								<th md-column>Value</th>
							</tr>
						</thead>
						<tbody md-body>
							<tr md-row>
								<td md-cell>Old ID</td>
								<td md-cell>{{ data.lysate.oldid }}</td>
							</tr>
							<tr md-row>
								<td md-cell>Isolation Date</td>
								<td md-cell>{{ data.lysate.isolation }}</td>
							</tr>
						</tbody>
					</table>
				</md-table-container>
			</md-card-content>
		</md-card>
		<md-button class="md-raised md-primary" ng-if="!data.lysate">
			Lysate Data Missing
		</md-button>

		<div layout="row">
			<span flex></span>
			<ng-md-icon icon="arrow_upwards"></ng-md-icon>
			<span flex></span>
		</div>

		<md-card class="env-sample-card" ng-if="data.env_sample_collection">
			<md-toolbar layout="row" class="md-hue-2">
				<div class="md-toolbar-tools" flex>
					<span class="md-title">Environmental Sample</span>
				</div>
			</md-toolbar>
			<md-card-content>
				<!-- TODO MAP -->
				<h3>Samples</h3>

				<leaflet width="100%" height="299px" markers="map.markers" maxbounds="map.maxbounds" lf-center="map.center"></leaflet>

				<md-table-container>
					<table md-table md-progress="promise">
						<thead md-head>
							<tr md-row>
								<th md-column>Type</th>
								<th md-column>Description</th>
								<th md-column>Collection Location</th>
								<th md-column>Tube</th>
							</tr>
						</thead>
						<tbody md-body>
							<tr md-row ng-repeat="env_sample in data.env_sample_collection.env_sample">
								<td md-cell>{{ env_sample.sample_type.name }}</td>
								<td md-cell>{{ env_sample.description }}</td>
								<td md-cell>{{ env_sample.location }}</td>
								<td md-cell>
									<md-button ng-href="#/tubes/{{ env_sample.tube.id }}" aria-label="close" class="md-icon-button">
										<ng-md-icon icon="inbox"></ng-md-icon>
										<md-tooltip>
											Tube {{ env_sample.tube.name }}
										</md-tooltip>
									</md-button>
								</td>
							</tr>
						</tbody>
					</table>
				</md-table-container>
			</md-card-content>
		</md-card>
		<md-button class="md-raised md-primary" ng-if="!data.env_sample_collection">
			Environmental Sample Data Missing
		</md-button>




		<pre>
{{ data | json }}
		</pre>


	</div>
</div>
